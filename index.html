<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LordNine Guild Management</title>
  <meta name="description" content="Guild management dashboard (static) - members, attendance, events." />
  <style>
    :root{
      --bg:#0b1020;
      --text:#e7ecff;
      --muted:#a7b0d6;
      --line:rgba(255,255,255,.10);
      --accent:#6ea8fe;
      --good:#44d19d;
      --warn:#f7c948;
      --bad:#ff6b6b;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius:16px;
      --radius2:20px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(900px 600px at 12% -10%, rgba(110,168,254,.20), transparent 60%),
        radial-gradient(900px 600px at 90% 0%, rgba(68,209,157,.12), transparent 60%),
        radial-gradient(900px 600px at 60% 110%, rgba(247,201,72,.10), transparent 60%),
        var(--bg);
      color:var(--text);
    }
    a{color:inherit;text-decoration:none}
    button,input,select,textarea{font:inherit}
    .app{display:grid;grid-template-columns:280px 1fr;min-height:100vh}
    .sidebar{
      position:sticky;top:0;height:100vh;padding:22px 18px;
      border-right:1px solid var(--line);
      background: linear-gradient(180deg, rgba(15,23,48,.90), rgba(10,16,34,.60));
      backdrop-filter: blur(10px);
    }
    .brand{display:flex;align-items:center;gap:12px;padding:10px 10px 16px;margin-bottom:10px}
    .logo{
      width:44px;height:44px;border-radius:14px;
      background:
        radial-gradient(18px 18px at 30% 25%, rgba(255,255,255,.25), transparent 60%),
        linear-gradient(135deg, rgba(110,168,254,.90), rgba(68,209,157,.80));
      box-shadow: 0 10px 20px rgba(0,0,0,.35);
    }
    .brand h1{font-size:14px;margin:0;letter-spacing:.3px;line-height:1.15}
    .brand p{margin:2px 0 0;font-size:12px;color:var(--muted)}
    .nav{display:flex;flex-direction:column;gap:6px;margin-top:12px}
    .nav a{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:10px 12px;border-radius:14px;color:var(--muted);
      border:1px solid transparent;transition:.15s ease;
    }
    .nav a:hover{background:rgba(255,255,255,.04);border-color:rgba(255,255,255,.06);color:var(--text)}
    .nav a.active{background:rgba(110,168,254,.12);border-color:rgba(110,168,254,.22);color:var(--text)}
    .pill{
      font-size:12px;padding:4px 8px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04);color:var(--muted)
    }

    .sidebar .footer{
      position:absolute;left:18px;right:18px;bottom:18px;
      padding:14px;border-radius:var(--radius);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .footer .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .footer small{color:var(--muted)}

    .main{padding:24px 26px 40px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:18px}
    .topbar h2{margin:0;font-size:18px;letter-spacing:.2px}
    .search{
      flex:1;max-width:520px;display:flex;align-items:center;gap:10px;
      padding:10px 12px;border-radius:14px;
      background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);
    }
    .search input{width:100%;border:0;outline:0;background:transparent;color:var(--text)}
    .actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      color:var(--text);
      border-radius:14px;padding:10px 12px;cursor:pointer;transition:.15s ease;
    }
    .btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.18)}
    .btn.primary{background:rgba(110,168,254,.18);border-color:rgba(110,168,254,.30)}
    .btn.danger{background:rgba(255,107,107,.12);border-color:rgba(255,107,107,.25)}
    .btn.ghost{background:transparent}
    .btn.small{padding:7px 10px;border-radius:12px;font-size:13px}
    .btn[disabled]{opacity:.55;cursor:not-allowed;transform:none !important}

    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
    .card{
      border-radius:var(--radius2);
      background:linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.10);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:16px 16px 10px;border-bottom:1px solid rgba(255,255,255,.06);
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px
    }
    .card .hd h3{margin:0;font-size:14px}
    .card .hd p{margin:4px 0 0;color:var(--muted);font-size:12px}
    .card .bd{padding:14px 16px 16px}

    .stat{display:flex;flex-direction:column;gap:6px}
    .stat .num{font-size:24px;font-weight:700;letter-spacing:.2px}
    .stat .sub{color:var(--muted);font-size:12px}
    .stat .trend{
      font-size:12px;padding:4px 8px;border-radius:999px;width:fit-content;
      border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04);color:var(--muted)
    }

    .table{
      width:100%;border-collapse:separate;border-spacing:0;
      overflow:hidden;border-radius:14px;border:1px solid rgba(255,255,255,.10)
    }
    .table th,.table td{
      text-align:left;padding:10px 10px;font-size:13px;border-bottom:1px solid rgba(255,255,255,.06)
    }
    .table th{color:var(--muted);font-weight:600;background:rgba(255,255,255,.03)}
    .table tr:last-child td{border-bottom:0}

    .tag{
      display:inline-flex;align-items:center;gap:6px;padding:4px 8px;font-size:12px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04);color:var(--muted);white-space:nowrap
    }
    .dot{width:8px;height:8px;border-radius:99px;background:rgba(255,255,255,.35)}
    .dot.good{background:var(--good)}
    .dot.warn{background:var(--warn)}
    .dot.bad{background:var(--bad)}

    .form{display:grid;grid-template-columns:repeat(12,1fr);gap:10px;margin-top:10px}
    .field{grid-column:span 6;display:flex;flex-direction:column;gap:6px}
    .field.full{grid-column:1 / -1}
    label{font-size:12px;color:var(--muted)}
    input,select,textarea{
      padding:10px 10px;border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.12);
      color:var(--text);outline:none;
    }
    input::placeholder,textarea::placeholder{color:rgba(167,176,214,.65)}
    .rowbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:10px 0 0}
    .muted{color:var(--muted)}
    .mono{font-family:var(--mono)}
    .hide{display:none !important}

    .banner{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:12px 14px;border-radius:16px;margin:0 0 14px 0;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }

    .modalWrap{
      position:fixed;inset:0;background:rgba(0,0,0,.55);
      display:none;align-items:center;justify-content:center;padding:18px;z-index:50
    }
    .modal{
      width:min(760px, 100%);
      border-radius:20px;border:1px solid rgba(255,255,255,.12);
      background:linear-gradient(180deg, rgba(15,23,48,.98), rgba(10,16,34,.92));
      box-shadow:0 30px 90px rgba(0,0,0,.6);
      overflow:hidden;
    }
    .modal .hd{padding:16px 16px 10px;border-bottom:1px solid rgba(255,255,255,.06);display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
    .modal .bd{padding:14px 16px 16px}
    .error{color:var(--bad);font-size:13px;margin-top:8px}

    @media (max-width: 980px){
      .app{grid-template-columns:1fr}
      .sidebar{position:relative;height:auto}
      .sidebar .footer{position:relative;left:auto;right:auto;bottom:auto;margin-top:12px}
      .search{max-width:unset}
    }
    @media (max-width: 640px){
      .field{grid-column:1 / -1}
      .topbar{flex-direction:column;align-items:stretch}
      .actions{justify-content:flex-end}
      .banner{flex-direction:column;align-items:flex-start}
      .sidebar .footer .row{flex-direction:column;align-items:flex-start}
    }
  </style>
</head>

<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>LordNine Guild Management</h1>
          <p class="mono">static • github pages</p>
        </div>
      </div>

      <nav class="nav" id="nav">
        <a href="#dashboard" data-route="dashboard" class="active"><span>Dashboard</span><span class="pill" id="pillMembers">0</span></a>
        <a href="#members" data-route="members"><span>Members</span><span class="pill">Roster</span></a>
        <a href="#attendance" data-route="attendance"><span>Attendance</span><span class="pill">Boss</span></a>
        <a href="#events" data-route="events"><span>Events</span><span class="pill">Calendar</span></a>
        <a href="#settings" data-route="settings" data-admin-only="1"><span>Settings</span><span class="pill">Local</span></a>
      </nav>

      <div class="footer">
        <div class="row">
          <div>
            <small class="muted">Access</small>
            <div style="margin-top:6px;font-size:13px;">
              <span id="accessLabel" class="tag"><span class="dot warn"></span> Viewer</span>
            </div>
          </div>
          <button class="btn" id="btnExport" data-admin-only="1">Export</button>
        </div>
        <!-- Removed Ctrl/K/Quick add hint (as requested) -->
      </div>
    </aside>

    <main class="main">
      <header class="topbar">
        <h2 id="pageTitle">Dashboard</h2>

        <div class="search" role="search">
          <span class="muted mono">/</span>
          <input id="globalSearch" placeholder="Search members, attendance, events, notes…" autocomplete="off" />
        </div>

        <div class="actions">
          <button class="btn primary" id="btnQuickAdd" data-admin-only="1">Quick Add</button>
          <button class="btn danger" id="btnReset" data-admin-only="1">Reset</button>

          <button class="btn" id="btnAdminLogin">Admin Login</button>
          <button class="btn ghost hide" id="btnAdminLogout">Logout</button>
        </div>
      </header>

      <div class="banner" id="viewerBanner">
        <div>
          <div style="font-weight:700;letter-spacing:.2px;">Viewer mode</div>
          <div class="muted" style="font-size:13px;margin-top:4px;">
            You can view roster and attendance. Admin actions are locked.
          </div>
        </div>
        <button class="btn primary small" id="btnAdminLogin2">Login as Admin</button>
      </div>

      <!-- DASHBOARD -->
      <section id="view-dashboard">
        <div class="grid">
          <div class="card" style="grid-column: span 4;">
            <div class="hd">
              <div>
                <h3>Total Members</h3>
                <p>Active roster size</p>
              </div>
              <span class="tag"><span class="dot good"></span> live</span>
            </div>
            <div class="bd stat">
              <div class="num" id="statMembers">0</div>
              <div class="sub">Saved locally in your browser</div>
              <div class="trend" id="trendMembers">No data yet</div>
            </div>
          </div>

          <div class="card" style="grid-column: span 4;">
            <div class="hd">
              <div>
                <h3>Boss Attendance</h3>
                <p>Last 7 entries</p>
              </div>
              <span class="tag"><span class="dot warn"></span> tracking</span>
            </div>
            <div class="bd stat">
              <div class="num" id="statAttendance">0%</div>
              <div class="sub">Average participation rate</div>
              <div class="trend" id="trendAttendance">Viewer can view logs</div>
            </div>
          </div>

          <div class="card" style="grid-column: span 4;">
            <div class="hd">
              <div>
                <h3>Upcoming Events</h3>
                <p>Next 14 days</p>
              </div>
              <span class="tag"><span class="dot"></span> planning</span>
            </div>
            <div class="bd stat">
              <div class="num" id="statEvents">0</div>
              <div class="sub">Scheduled raids / meetings</div>
              <div class="trend" id="trendEvents">Add your first event</div>
            </div>
          </div>

          <div class="card" style="grid-column: span 8;">
            <div class="hd">
              <div>
                <h3>Roster Overview</h3>
                <p>Newest members first</p>
              </div>
              <span class="tag"><span class="dot good"></span> members</span>
            </div>
            <div class="bd">
              <table class="table" aria-label="Members table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Power</th>
                    <th>Status</th>
                    <th style="width:140px;">Actions</th>
                  </tr>
                </thead>
                <tbody id="membersTableBody"></tbody>
              </table>
              <div class="rowbar">
                <div class="muted">Viewer can view. Admin can edit.</div>
                <a class="btn" href="#members">Open roster</a>
              </div>
            </div>
          </div>

          <div class="card" style="grid-column: span 4;">
            <div class="hd">
              <div>
                <h3>Recent Notes</h3>
                <p>Quick guild reminders</p>
              </div>
              <span class="tag"><span class="dot"></span> memo</span>
            </div>
            <div class="bd">
              <textarea id="notes" rows="10" style="width:100%;resize:vertical;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.12);color:var(--text);outline:none" placeholder="Locked (admin only)."></textarea>
              <div class="rowbar">
                <span class="muted" id="notesHint">Locked (admin only)</span>
                <button class="btn primary" id="btnSaveNotes" data-admin-only="1">Save</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- MEMBERS (VISIBLE TO ALL, VIEW-ONLY FOR VISITORS) -->
      <section id="view-members" class="hide">
        <div class="grid">
          <!-- Admin add/edit panel -->
          <div class="card" style="grid-column: span 5;" data-admin-only="1">
            <div class="hd">
              <div>
                <h3>Add Member</h3>
                <p>Admin only</p>
              </div>
              <span class="tag"><span class="dot good"></span> roster</span>
            </div>
            <div class="bd">
              <form id="memberForm" class="form">
                <div class="field">
                  <label>Name</label>
                  <input id="mName" placeholder="e.g., Raidium" required />
                </div>
                <div class="field">
                  <label>Role</label>
                  <select id="mRole">
                    <option>Guild Master</option>
                    <option>Officer</option>
                    <option>Raid Lead</option>
                    <option>Member</option>
                    <option>Recruit</option>
                  </select>
                </div>
                <div class="field">
                  <label>Power</label>
                  <input id="mPower" placeholder="e.g., 125000" inputmode="numeric" />
                </div>
                <div class="field">
                  <label>Status</label>
                  <select id="mStatus">
                    <option value="Active">Active</option>
                    <option value="Trial">Trial</option>
                    <option value="Inactive">Inactive</option>
                  </select>
                </div>
                <div class="field full">
                  <label>Notes</label>
                  <input id="mNotes" placeholder="e.g., Healer main, prefers weekends" />
                </div>
                <div class="field full" style="display:flex;flex-direction:row;gap:10px;justify-content:flex-end;">
                  <button type="button" class="btn" id="btnClearMember">Clear</button>
                  <button class="btn primary" type="submit">Save Member</button>
                </div>
              </form>
              <div class="muted" style="margin-top:10px;font-size:12px;">
                Stored in <span class="mono">localStorage</span> (no server).
              </div>
            </div>
          </div>

          <!-- Public roster table -->
          <div class="card" style="grid-column: span 7;">
            <div class="hd">
              <div>
                <h3>All Members</h3>
                <p id="membersModeHint">Viewer: read-only</p>
              </div>
              <span class="tag"><span class="dot"></span> list</span>
            </div>
            <div class="bd">
              <table class="table" aria-label="All members table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Power</th>
                    <th>Status</th>
                    <th>Notes</th>
                    <th style="width:140px;">Actions</th>
                  </tr>
                </thead>
                <tbody id="allMembersBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- ATTENDANCE (VISIBLE TO ALL, VIEW-ONLY FOR VISITORS) -->
      <section id="view-attendance" class="hide">
        <div class="grid">
          <!-- Admin log panel -->
          <div class="card" style="grid-column: span 5;" data-admin-only="1">
            <div class="hd">
              <div>
                <h3>Log Boss Attendance</h3>
                <p>Admin only</p>
              </div>
              <span class="tag"><span class="dot warn"></span> boss</span>
            </div>
            <div class="bd">
              <form id="attendanceForm" class="form">
                <div class="field">
                  <label>Boss / Activity</label>
                  <input id="aBoss" placeholder="e.g., Medea Raid" required />
                </div>
                <div class="field">
                  <label>Date</label>
                  <input id="aDate" type="date" required />
                </div>
                <div class="field">
                  <label>Attended (count)</label>
                  <input id="aAttended" placeholder="e.g., 25" inputmode="numeric" />
                </div>
                <div class="field">
                  <label>Total Roster (count)</label>
                  <input id="aTotal" placeholder="e.g., 35" inputmode="numeric" />
                </div>
                <div class="field full" style="display:flex;flex-direction:row;gap:10px;justify-content:flex-end;">
                  <button type="button" class="btn" id="btnClearAttendance">Clear</button>
                  <button class="btn primary" type="submit">Save Log</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Public attendance logs -->
          <div class="card" style="grid-column: span 7;">
            <div class="hd">
              <div>
                <h3>Attendance Logs</h3>
                <p id="attendanceModeHint">Viewer: read-only</p>
              </div>
              <span class="tag"><span class="dot"></span> history</span>
            </div>
            <div class="bd">
              <table class="table" aria-label="Attendance table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Boss</th>
                    <th>Attended</th>
                    <th>Total</th>
                    <th>Rate</th>
                    <th style="width:120px;">Actions</th>
                  </tr>
                </thead>
                <tbody id="attendanceBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- EVENTS (PUBLIC VIEW; ADMIN CAN ADD/DELETE) -->
      <section id="view-events" class="hide">
        <div class="grid">
          <div class="card" style="grid-column: span 5;" data-admin-only="1">
            <div class="hd">
              <div>
                <h3>Create Event</h3>
                <p>Admin only</p>
              </div>
              <span class="tag"><span class="dot"></span> schedule</span>
            </div>
            <div class="bd">
              <form id="eventForm" class="form">
                <div class="field">
                  <label>Title</label>
                  <input id="eTitle" placeholder="e.g., Weekly Raid" required />
                </div>
                <div class="field">
                  <label>Date</label>
                  <input id="eDate" type="date" required />
                </div>
                <div class="field">
                  <label>Time</label>
                  <input id="eTime" type="time" required />
                </div>
                <div class="field">
                  <label>Type</label>
                  <select id="eType">
                    <option value="Raid">Raid</option>
                    <option value="Meeting">Meeting</option>
                    <option value="Tryout">Tryout</option>
                    <option value="Event">Event</option>
                  </select>
                </div>
                <div class="field full">
                  <label>Notes</label>
                  <input id="eNotes" placeholder="e.g., Min power 100k, bring pots" />
                </div>
                <div class="field full" style="display:flex;flex-direction:row;gap:10px;justify-content:flex-end;">
                  <button type="button" class="btn" id="btnClearEvent">Clear</button>
                  <button class="btn primary" type="submit">Save Event</button>
                </div>
              </form>
            </div>
          </div>

          <div class="card" style="grid-column: span 7;">
            <div class="hd">
              <div>
                <h3>Upcoming Events</h3>
                <p>Sorted by date/time</p>
              </div>
              <span class="tag"><span class="dot good"></span> next up</span>
            </div>
            <div class="bd">
              <table class="table" aria-label="Events table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Title</th>
                    <th>Type</th>
                    <th>Notes</th>
                    <th style="width:120px;">Actions</th>
                  </tr>
                </thead>
                <tbody id="eventsBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- SETTINGS (ADMIN ONLY) -->
      <section id="view-settings" class="hide" data-admin-only="1">
        <div class="grid">
          <div class="card" style="grid-column: span 7;">
            <div class="hd">
              <div>
                <h3>Data</h3>
                <p>Admin only</p>
              </div>
              <span class="tag"><span class="dot"></span> local</span>
            </div>
            <div class="bd">
              <div class="muted" style="font-size:13px;">
                Static site. Everything is saved in your browser only.
              </div>

              <div class="rowbar" style="margin-top:12px;">
                <button class="btn" id="btnExport2">Export JSON</button>
                <label class="btn" style="cursor:pointer;">
                  Import JSON
                  <input id="importFile" type="file" accept="application/json" style="display:none;">
                </label>
                <button class="btn danger" id="btnWipe">Wipe All Data</button>
              </div>

              <pre id="exportPreview" style="margin-top:12px;white-space:pre-wrap;word-break:break-word;background:rgba(0,0,0,.16);border:1px solid rgba(255,255,255,.10);padding:12px;border-radius:14px;max-height:320px;overflow:auto;"></pre>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- QUICK ADD MODAL (ADMIN ONLY) -->
  <div class="modalWrap" id="modalWrap" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="hd">
        <div>
          <h3 id="modalTitle" style="margin:0;font-size:14px;">Quick Add</h3>
          <p class="muted" style="margin:4px 0 0;font-size:12px;">Admin only.</p>
        </div>
        <button class="btn" id="btnCloseModal">Close</button>
      </div>
      <div class="bd">
        <form id="quickForm" class="form">
          <div class="field">
            <label>Name</label>
            <input id="qName" placeholder="Member name" required />
          </div>
          <div class="field">
            <label>Role</label>
            <select id="qRole">
              <option>Member</option>
              <option>Recruit</option>
              <option>Officer</option>
              <option>Raid Lead</option>
              <option>Guild Master</option>
            </select>
          </div>
          <div class="field">
            <label>Power</label>
            <input id="qPower" placeholder="125000" inputmode="numeric" />
          </div>
          <div class="field">
            <label>Status</label>
            <select id="qStatus">
              <option value="Active">Active</option>
              <option value="Trial">Trial</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>
          <div class="field full" style="display:flex;justify-content:flex-end;gap:10px;">
            <button type="button" class="btn" id="btnQuickCancel">Cancel</button>
            <button class="btn primary" type="submit">Add</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ADMIN LOGIN MODAL -->
  <div class="modalWrap" id="loginWrap" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <div class="hd">
        <div>
          <h3 id="loginTitle" style="margin:0;font-size:14px;">Admin Login</h3>
          <p class="muted" style="margin:4px 0 0;font-size:12px;">Unlock editing tools.</p>
        </div>
        <button class="btn" id="btnCloseLogin">Close</button>
      </div>
      <div class="bd">
        <form id="loginForm" class="form">
          <div class="field full">
            <label>Username</label>
            <input id="loginUser" autocomplete="username" placeholder="user" required />
          </div>
          <div class="field full">
            <label>Password</label>
            <input id="loginPass" type="password" autocomplete="current-password" placeholder="pass" required />
          </div>
          <div class="field full" style="display:flex;justify-content:flex-end;gap:10px;">
            <button type="button" class="btn" id="btnLoginCancel">Cancel</button>
            <button class="btn primary" type="submit">Login</button>
          </div>
          <div id="loginError" class="error hide">Wrong username or password.</div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // ---------------- Admin Auth (STATIC FRONTEND GATE) ----------------
    const ADMIN_USER = "nightfall";
    const ADMIN_PASS = "onlynightfall";
    const AUTH_KEY = "l9_admin_authed_v2"; // sessionStorage only
    const isAdmin = () => sessionStorage.getItem(AUTH_KEY) === "1";
    const setAdmin = (v) => sessionStorage.setItem(AUTH_KEY, v ? "1" : "0");

    // ---------- Storage ----------
    const KEY = "l9_guild_management_v3";
    const defaultState = () => ({ members: [], attendance: [], events: [], notes: "" });

    const load = () => {
      try{
        const raw = localStorage.getItem(KEY);
        if(!raw) return defaultState();
        const data = JSON.parse(raw);
        return {
          members: Array.isArray(data.members) ? data.members : [],
          attendance: Array.isArray(data.attendance) ? data.attendance : [],
          events: Array.isArray(data.events) ? data.events : [],
          notes: typeof data.notes === "string" ? data.notes : ""
        };
      }catch(e){ return defaultState(); }
    };
    const save = () => localStorage.setItem(KEY, JSON.stringify(state));
    let state = load();

    // ---------- Helpers ----------
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const uid = () => Math.random().toString(36).slice(2,10) + Date.now().toString(36);
    const clamp = (n,min,max) => Math.max(min, Math.min(max, n));
    const fmtNum = (n) => { const x = Number(n); return Number.isFinite(x) ? x.toLocaleString() : ""; };
    const statusDot = (status) => status === "Active" ? "good" : status === "Trial" ? "warn" : "bad";
    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
        .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }

    function toast(msg){
      let el = document.getElementById("toast");
      if(!el){
        el = document.createElement("div");
        el.id = "toast";
        el.style.position = "fixed";
        el.style.left = "50%";
        el.style.bottom = "18px";
        el.style.transform = "translateX(-50%)";
        el.style.padding = "10px 12px";
        el.style.borderRadius = "14px";
        el.style.border = "1px solid rgba(255,255,255,.12)";
        el.style.background = "rgba(15,23,48,.92)";
        el.style.boxShadow = "0 14px 40px rgba(0,0,0,.55)";
        el.style.color = "var(--text)";
        el.style.fontSize = "13px";
        el.style.zIndex = "100";
        document.body.appendChild(el);
      }
      el.textContent = msg;
      el.style.opacity = "1";
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=>{ el.style.opacity = "0"; }, 1400);
    }

    // ---------------- UI Gating ----------------
    const applyAdminUI = () => {
      const admin = isAdmin();

      // Show admin-only widgets/buttons
      $$("[data-admin-only='1']").forEach(el => el.classList.toggle("hide", !admin));

      // Viewer banner
      $("#viewerBanner").classList.toggle("hide", admin);

      // Login/Logout buttons
      $("#btnAdminLogin").classList.toggle("hide", admin);
      $("#btnAdminLogout").classList.toggle("hide", !admin);

      // Access label
      $("#accessLabel").innerHTML = admin
        ? `<span class="dot good"></span> Admin`
        : `<span class="dot warn"></span> Viewer`;

      // Notes locking
      const notes = $("#notes");
      notes.readOnly = !admin;
      notes.placeholder = admin
        ? "Example:\n• Raid time: 9:00 PM\n• Bring resistance pots\n• New recruits interview on Friday"
        : "Locked (admin only).";
      $("#notesHint").textContent = admin ? "Autosaves" : "Locked (admin only)";

      // Members/attendance mode hints
      $("#membersModeHint").textContent = admin ? "Admin: edit enabled" : "Viewer: read-only";
      $("#attendanceModeHint").textContent = admin ? "Admin: manage logs" : "Viewer: read-only";

      // If viewer tries to do admin-only action, those buttons are hidden anyway.
      // Routes: only Settings is admin-only now
      const hashRoute = (location.hash || "#dashboard").replace("#","");
      if(!admin && hashRoute === "settings"){
        location.hash = "#dashboard";
      }

      // Quick add modal admin-only
      if(!admin) closeQuickModal();
    };

    // ---------- Routing ----------
    const routes = ["dashboard","members","attendance","events","settings"];
    const setRoute = (route) => {
      if(!routes.includes(route)) route = "dashboard";
      if(!isAdmin() && route === "settings"){
        route = "dashboard";
        location.hash = "#dashboard";
      }
      $("#pageTitle").textContent = route[0].toUpperCase() + route.slice(1);
      routes.forEach(r => {
        $("#view-" + r).classList.toggle("hide", r !== route);
        const a = document.querySelector(`[data-route="${r}"]`);
        if(a) a.classList.toggle("active", r === route);
      });
    };
    window.addEventListener("hashchange", () => {
      const route = (location.hash || "#dashboard").replace("#","");
      setRoute(route);
      applyAdminUI();
      renderAll($("#globalSearch").value || "");
    });

    // ---------- Render ----------
    const renderMembers = (filter = "") => {
      const q = filter.trim().toLowerCase();
      const admin = isAdmin();

      const members = [...state.members].sort((a,b) => (b.createdAt||0) - (a.createdAt||0));
      const filtered = q
        ? members.filter(m =>
            (m.name||"").toLowerCase().includes(q) ||
            (m.role||"").toLowerCase().includes(q) ||
            (m.status||"").toLowerCase().includes(q) ||
            (m.notes||"").toLowerCase().includes(q)
          )
        : members;

      // Dashboard quick table
      const dashRows = filtered.slice(0,6).map(m => `
        <tr>
          <td><strong>${escapeHtml(m.name)}</strong></td>
          <td>${escapeHtml(m.role)}</td>
          <td class="mono">${escapeHtml(fmtNum(m.power))}</td>
          <td><span class="tag"><span class="dot ${statusDot(m.status)}"></span>${escapeHtml(m.status)}</span></td>
          <td>
            <button class="btn ${admin ? "" : "ghost"}" data-edit="${m.id}" ${admin ? "" : "disabled title='Admin only'"}>Edit</button>
          </td>
        </tr>
      `).join("");

      $("#membersTableBody").innerHTML = dashRows || `
        <tr><td colspan="5" class="muted">No members yet.</td></tr>
      `;

      // Members page table (always visible)
      const allRows = filtered.map(m => `
        <tr>
          <td><strong>${escapeHtml(m.name)}</strong></td>
          <td>${escapeHtml(m.role)}</td>
          <td class="mono">${escapeHtml(fmtNum(m.power))}</td>
          <td><span class="tag"><span class="dot ${statusDot(m.status)}"></span>${escapeHtml(m.status)}</span></td>
          <td class="muted">${escapeHtml(m.notes || "")}</td>
          <td>
            ${admin
              ? `<button class="btn" data-edit="${m.id}">Edit</button>
                 <button class="btn danger" data-del="${m.id}">Del</button>`
              : `<span class="muted">—</span>`}
          </td>
        </tr>
      `).join("");

      $("#allMembersBody").innerHTML = allRows || `
        <tr><td colspan="6" class="muted">No roster data yet.</td></tr>
      `;

      $("#statMembers").textContent = String(state.members.length);
      $("#pillMembers").textContent = String(state.members.length);
      $("#trendMembers").textContent = state.members.length ? `${state.members.length} saved members` : "No data yet";
    };

    const renderAttendance = () => {
      const logs = [...state.attendance].sort((a,b) => (b.ts||0) - (a.ts||0));
      const admin = isAdmin();

      const rows = logs.map(l => {
        const attended = Number(l.attended||0);
        const total = Math.max(1, Number(l.total||1));
        const rate = clamp(Math.round((attended/total)*100), 0, 100);
        return `
          <tr>
            <td class="mono">${escapeHtml(l.date)}</td>
            <td>${escapeHtml(l.boss)}</td>
            <td class="mono">${escapeHtml(String(attended))}</td>
            <td class="mono">${escapeHtml(String(total))}</td>
            <td><span class="tag"><span class="dot ${rate >= 80 ? "good" : rate >= 60 ? "warn" : "bad"}"></span>${rate}%</span></td>
            <td>
              ${admin ? `<button class="btn danger" data-del-att="${l.id}">Del</button>` : `<span class="muted">—</span>`}
            </td>
          </tr>
        `;
      }).join("");

      $("#attendanceBody").innerHTML = rows || `
        <tr><td colspan="6" class="muted">No logs yet.</td></tr>
      `;

      const recent = logs.slice(0,7);
      const avg = recent.length
        ? Math.round(recent.reduce((sum,l)=>{
            const a = Number(l.attended||0);
            const t = Math.max(1, Number(l.total||1));
            return sum + (a/t)*100;
          },0) / recent.length)
        : 0;

      $("#statAttendance").textContent = recent.length ? `${avg}%` : "0%";
      $("#trendAttendance").textContent = recent.length ? `Avg from last ${recent.length} logs` : "No attendance logs yet";
    };

    const renderEvents = () => {
      const now = new Date();
      const in14 = new Date(now.getTime() + 14*24*60*60*1000);

      const events = [...state.events].sort((a,b) => ((a.date||"") + (a.time||"")).localeCompare((b.date||"") + (b.time||"")));
      const admin = isAdmin();

      const rows = events.map(e => `
        <tr>
          <td class="mono">${escapeHtml(e.date)}</td>
          <td class="mono">${escapeHtml(e.time)}</td>
          <td><strong>${escapeHtml(e.title)}</strong></td>
          <td><span class="tag"><span class="dot ${e.type==="Raid" ? "warn" : "good"}"></span>${escapeHtml(e.type)}</span></td>
          <td class="muted">${escapeHtml(e.notes||"")}</td>
          <td>
            ${admin ? `<button class="btn danger" data-del-ev="${e.id}">Del</button>` : `<span class="muted">—</span>`}
          </td>
        </tr>
      `).join("");

      $("#eventsBody").innerHTML = rows || `
        <tr><td colspan="6" class="muted">No events yet.</td></tr>
      `;

      const upcoming14 = events.filter(e => {
        const d = new Date(e.date + "T" + (e.time || "00:00"));
        return d >= now && d <= in14;
      });

      $("#statEvents").textContent = String(upcoming14.length);
      $("#trendEvents").textContent = upcoming14.length ? `Next 14 days: ${upcoming14.length}` : "No upcoming events";
    };

    const renderNotes = () => { $("#notes").value = state.notes || ""; };

    const renderExportPreview = () => {
      const el = $("#exportPreview");
      if(!el) return;
      const preview = {
        members: state.members.slice(0, 3),
        attendance: state.attendance.slice(0, 3),
        events: state.events.slice(0, 3),
        notes: (state.notes || "").slice(0, 120)
      };
      el.textContent = JSON.stringify(preview, null, 2);
    };

    const renderAll = (filter="") => {
      renderMembers(filter);
      renderAttendance();
      renderEvents();
      renderNotes();
      renderExportPreview();
      applyAdminUI();
    };

    // ---------- Search ----------
    $("#globalSearch").addEventListener("input", () => renderAll($("#globalSearch").value || ""));

    // ---------- Admin Login Modal ----------
    const loginWrap = $("#loginWrap");
    const openLogin = () => {
      $("#loginError").classList.add("hide");
      loginWrap.style.display = "flex";
      loginWrap.setAttribute("aria-hidden","false");
      $("#loginUser").value = "";
      $("#loginPass").value = "";
      $("#loginUser").focus();
    };
    const closeLogin = () => {
      loginWrap.style.display = "none";
      loginWrap.setAttribute("aria-hidden","true");
    };

    $("#btnAdminLogin").addEventListener("click", openLogin);
    $("#btnAdminLogin2").addEventListener("click", openLogin);
    $("#btnCloseLogin").addEventListener("click", closeLogin);
    $("#btnLoginCancel").addEventListener("click", closeLogin);
    loginWrap.addEventListener("click", (e)=>{ if(e.target===loginWrap) closeLogin(); });

    $("#loginForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const u = $("#loginUser").value.trim();
      const p = $("#loginPass").value;
      if(u === "nightfall" && p === "onlynightfall"){
        setAdmin(true);
        closeLogin();
        toast("Admin unlocked.");
        renderAll($("#globalSearch").value || "");
      } else {
        $("#loginError").classList.remove("hide");
      }
    });

    $("#btnAdminLogout").addEventListener("click", () => {
      setAdmin(false);
      toast("Logged out.");
      if(location.hash === "#settings") location.hash = "#dashboard";
      renderAll($("#globalSearch").value || "");
    });

    // ---------- Quick Add Modal (ADMIN ONLY) ----------
    const modalWrap = $("#modalWrap");
    const openQuickModal = () => {
      if(!isAdmin()){ toast("Admin only."); openLogin(); return; }
      modalWrap.style.display = "flex";
      modalWrap.setAttribute("aria-hidden","false");
      $("#qName").focus();
    };
    const closeQuickModal = () => {
      modalWrap.style.display = "none";
      modalWrap.setAttribute("aria-hidden","true");
    };
    $("#btnQuickAdd").addEventListener("click", openQuickModal);
    $("#btnCloseModal").addEventListener("click", closeQuickModal);
    $("#btnQuickCancel").addEventListener("click", closeQuickModal);
    modalWrap.addEventListener("click", (e)=>{ if(e.target===modalWrap) closeQuickModal(); });

    // ---------- Forms (ADMIN ONLY) ----------
    let editingMemberId = null;

    $("#memberForm")?.addEventListener("submit", (e) => {
      e.preventDefault();
      if(!isAdmin()){ toast("Admin only."); return; }
      const member = {
        id: editingMemberId || uid(),
        name: $("#mName").value.trim(),
        role: $("#mRole").value,
        power: ($("#mPower").value || "").trim(),
        status: $("#mStatus").value,
        notes: $("#mNotes").value.trim(),
        createdAt: editingMemberId
          ? (state.members.find(m=>m.id===editingMemberId)?.createdAt || Date.now())
          : Date.now()
      };
      if(!member.name) return;

      const idx = state.members.findIndex(m => m.id === member.id);
      if(idx >= 0) state.members[idx] = member;
      else state.members.push(member);

      editingMemberId = null;
      e.target.reset();
      $("#mRole").value = "Guild Master";
      $("#mStatus").value = "Active";

      save();
      renderAll($("#globalSearch").value || "");
      toast("Member saved.");
    });

    $("#btnClearMember")?.addEventListener("click", () => {
      if(!isAdmin()){ toast("Admin only."); return; }
      editingMemberId = null;
      $("#memberForm").reset();
      $("#mRole").value = "Guild Master";
      $("#mStatus").value = "Active";
    });

    $("#attendanceForm")?.addEventListener("submit", (e) => {
      e.preventDefault();
      if(!isAdmin()){ toast("Admin only."); return; }
      const boss = $("#aBoss").value.trim();
      const date = $("#aDate").value;
      const attended = Number($("#aAttended").value || 0);
      const total = Number($("#aTotal").value || Math.max(1, state.members.length || 1));
      if(!boss || !date) return;

      state.attendance.push({ id: uid(), boss, date, attended: Math.max(0, attended), total: Math.max(1, total), ts: Date.now() });
      e.target.reset();
      $("#aDate").value = date;

      save();
      renderAll($("#globalSearch").value || "");
      toast("Attendance logged.");
    });

    $("#btnClearAttendance")?.addEventListener("click", () => {
      if(!isAdmin()){ toast("Admin only."); return; }
      $("#attendanceForm").reset();
    });

    $("#eventForm")?.addEventListener("submit", (e) => {
      e.preventDefault();
      if(!isAdmin()){ toast("Admin only."); return; }
      const title = $("#eTitle").value.trim();
      const date = $("#eDate").value;
      const time = $("#eTime").value;
      const type = $("#eType").value;
      const notes = $("#eNotes").value.trim();
      if(!title || !date || !time) return;

      state.events.push({ id: uid(), title, date, time, type, notes, ts: Date.now() });
      e.target.reset();
      save();
      renderAll($("#globalSearch").value || "");
      toast("Event saved.");
    });

    $("#btnClearEvent")?.addEventListener("click", () => {
      if(!isAdmin()){ toast("Admin only."); return; }
      $("#eventForm").reset();
    });

    $("#btnSaveNotes").addEventListener("click", () => {
      if(!isAdmin()){ toast("Admin only."); return; }
      state.notes = $("#notes").value || "";
      save();
      toast("Notes saved.");
    });

    $("#notes").addEventListener("input", () => {
      if(!isAdmin()) return;
      state.notes = $("#notes").value || "";
      save();
    });

    // ---------- Table actions ----------
    document.addEventListener("click", (e) => {
      const editId = e.target?.dataset?.edit;
      const delId = e.target?.dataset?.del;
      const delAtt = e.target?.dataset?.delAtt;
      const delEv = e.target?.dataset?.delEv;

      if(editId){
        if(!isAdmin()){ toast("Admin only."); openLogin(); return; }
        const m = state.members.find(x => x.id === editId);
        if(!m) return;
        location.hash = "#members";
        editingMemberId = m.id;
        $("#mName").value = m.name || "";
        $("#mRole").value = m.role || "Member";
        $("#mPower").value = m.power || "";
        $("#mStatus").value = m.status || "Active";
        $("#mNotes").value = m.notes || "";
        toast("Editing member…");
      }

      if(delId){
        if(!isAdmin()){ toast("Admin only."); return; }
        state.members = state.members.filter(m => m.id !== delId);
        save(); renderAll($("#globalSearch").value || "");
        toast("Member deleted.");
      }

      if(delAtt){
        if(!isAdmin()){ toast("Admin only."); return; }
        state.attendance = state.attendance.filter(a => a.id !== delAtt);
        save(); renderAll($("#globalSearch").value || "");
        toast("Log deleted.");
      }

      if(delEv){
        if(!isAdmin()){ toast("Admin only."); return; }
        state.events = state.events.filter(ev => ev.id !== delEv);
        save(); renderAll($("#globalSearch").value || "");
        toast("Event deleted.");
      }
    });

    // ---------- Reset (ADMIN ONLY) ----------
    $("#btnReset").addEventListener("click", () => {
      if(!isAdmin()){ toast("Admin only."); openLogin(); return; }
      $("#globalSearch").value = "";
      renderAll("");
      toast("View reset.");
    });

    // ---------- Export / Import (ADMIN ONLY) ----------
    const exportJson = () => {
      if(!isAdmin()){ toast("Admin only."); openLogin(); return; }
      const blob = new Blob([JSON.stringify(state, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "l9-guild-data.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      toast("Exported JSON.");
    };
    $("#btnExport").addEventListener("click", exportJson);
    $("#btnExport2")?.addEventListener("click", exportJson);

    $("#btnWipe")?.addEventListener("click", () => {
      if(!isAdmin()){ toast("Admin only."); openLogin(); return; }
      if(!confirm("Wipe ALL local data?")) return;
      state = defaultState();
      save();
      renderAll("");
      toast("All data wiped.");
    });

    $("#importFile")?.addEventListener("change", async (e) => {
      if(!isAdmin()){ toast("Admin only."); openLogin(); e.target.value=""; return; }
      const file = e.target.files?.[0];
      if(!file) return;
      try{
        const text = await file.text();
        const data = JSON.parse(text);
        state = {
          members: Array.isArray(data.members) ? data.members : [],
          attendance: Array.isArray(data.attendance) ? data.attendance : [],
          events: Array.isArray(data.events) ? data.events : [],
          notes: typeof data.notes === "string" ? data.notes : ""
        };
        save();
        renderAll($("#globalSearch").value || "");
        toast("Imported JSON.");
      }catch(err){
        alert("Import failed: invalid JSON");
      }finally{
        e.target.value = "";
      }
    });

    // ---------- Init ----------
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth()+1).padStart(2,"0");
    const dd = String(today.getDate()).padStart(2,"0");
    if($("#aDate")) $("#aDate").value = `${yyyy}-${mm}-${dd}`;
    if($("#eDate")) $("#eDate").value = `${yyyy}-${mm}-${dd}`;

    const route = (location.hash || "#dashboard").replace("#","");
    setRoute(route);
    renderAll("");

  </script>
</body>
</html>
